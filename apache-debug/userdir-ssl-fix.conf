# Fix for Apache UserDir with SSL
# This file should be placed in /etc/apache2/conf-available/
# Then enabled with: sudo a2enconf userdir-ssl-fix

# Ensure UserDir works with both HTTP and HTTPS
<IfModule mod_userdir.c>
    UserDir public_html
    UserDir disabled root

    # Allow access to user directories
    <Directory /home/*/public_html>
        AllowOverride FileInfo AuthConfig Limit Indexes
        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
        
        # Apache 2.4 syntax
        <RequireAll>
            Require all granted
            # Optional: Restrict methods
            Require method GET POST OPTIONS
        </RequireAll>
    </Directory>
</IfModule>

# Ensure PHP works in user directories (if needed)
<IfModule mod_php.c>
    <Directory /home/*/public_html>
        php_admin_flag engine On
    </Directory>
</IfModule>

<IfModule mod_php7.c>
    <Directory /home/*/public_html>
        php_admin_flag engine On
    </Directory>
</IfModule>

<IfModule mod_php8.c>
    <Directory /home/*/public_html>
        php_admin_flag engine On
    </Directory>
</IfModule>
